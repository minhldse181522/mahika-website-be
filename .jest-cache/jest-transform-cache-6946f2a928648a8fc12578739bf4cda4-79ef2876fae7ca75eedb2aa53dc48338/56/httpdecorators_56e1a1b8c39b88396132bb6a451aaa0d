2bca284d54006b6b8a312b59a8b85450
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ApiAuth = exports.ApiPublic = void 0;
const error_dto_1 = require("@/common/dto/error.dto");
const common_1 = require("@nestjs/common");
const swagger_1 = require("@nestjs/swagger");
const http_1 = require("http");
const public_decorator_1 = require("./public.decorator");
const swagger_decorators_1 = require("./swagger.decorators");
const ApiPublic = (options = {}) => {
    const defaultStatusCode = common_1.HttpStatus.OK;
    const defaultErrorResponses = [
        common_1.HttpStatus.BAD_REQUEST,
        common_1.HttpStatus.FORBIDDEN,
        common_1.HttpStatus.NOT_FOUND,
        common_1.HttpStatus.UNPROCESSABLE_ENTITY,
        common_1.HttpStatus.INTERNAL_SERVER_ERROR,
    ];
    const isPaginated = options.isPaginated || false;
    const ok = {
        type: options.type,
        description: options?.description ?? 'OK',
        paginationType: options.paginationType || 'offset',
    };
    const errorResponses = (options.errorResponses || defaultErrorResponses)?.map((statusCode) => (0, swagger_1.ApiResponse)({
        status: statusCode,
        type: error_dto_1.ErrorDto,
        description: http_1.STATUS_CODES[statusCode],
    }));
    return (0, common_1.applyDecorators)((0, public_decorator_1.Public)(), (0, swagger_1.ApiOperation)({ summary: options?.summary }), (0, common_1.HttpCode)(options.statusCode || defaultStatusCode), isPaginated ? (0, swagger_decorators_1.ApiPaginatedResponse)(ok) : (0, swagger_1.ApiOkResponse)(ok), ...errorResponses);
};
exports.ApiPublic = ApiPublic;
const ApiAuth = (options = {}) => {
    const defaultStatusCode = common_1.HttpStatus.OK;
    const defaultErrorResponses = [
        common_1.HttpStatus.BAD_REQUEST,
        common_1.HttpStatus.UNAUTHORIZED,
        common_1.HttpStatus.FORBIDDEN,
        common_1.HttpStatus.NOT_FOUND,
        common_1.HttpStatus.UNPROCESSABLE_ENTITY,
        common_1.HttpStatus.INTERNAL_SERVER_ERROR,
    ];
    const isPaginated = options.isPaginated || false;
    const ok = {
        type: options.type,
        description: options?.description ?? 'OK',
        paginationType: options.paginationType || 'offset',
    };
    const auths = options.auths || ['jwt'];
    const errorResponses = (options.errorResponses || defaultErrorResponses)?.map((statusCode) => (0, swagger_1.ApiResponse)({
        status: statusCode,
        type: error_dto_1.ErrorDto,
        description: http_1.STATUS_CODES[statusCode],
    }));
    const authDecorators = auths.map((auth) => {
        switch (auth) {
            case 'basic':
                return (0, swagger_1.ApiBasicAuth)();
            case 'api-key':
                return (0, swagger_1.ApiSecurity)('Api-Key');
            case 'jwt':
                return (0, swagger_1.ApiBearerAuth)();
        }
    });
    return (0, common_1.applyDecorators)((0, swagger_1.ApiOperation)({ summary: options?.summary }), (0, common_1.HttpCode)(options.statusCode || defaultStatusCode), isPaginated
        ? (0, swagger_decorators_1.ApiPaginatedResponse)(ok)
        : options.statusCode === 201
            ? (0, swagger_1.ApiCreatedResponse)(ok)
            : (0, swagger_1.ApiOkResponse)(ok), ...authDecorators, ...errorResponses);
};
exports.ApiAuth = ApiAuth;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXEZQVFxcU1VNTUVSXzIwMjVcXEVYRTIwMVxcbWFoaWthLXdlYnNpdGUtYmFja2VuZFxcc3JjXFxkZWNvcmF0b3JzXFxodHRwLmRlY29yYXRvcnMudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQUEsc0RBQWtEO0FBQ2xELDJDQUt3QjtBQUN4Qiw2Q0FReUI7QUFDekIsK0JBQW9DO0FBQ3BDLHlEQUE0QztBQUM1Qyw2REFBNEQ7QUFzQnJELE1BQU0sU0FBUyxHQUFHLENBQUMsVUFBNkIsRUFBRSxFQUFtQixFQUFFO0lBQzVFLE1BQU0saUJBQWlCLEdBQUcsbUJBQVUsQ0FBQyxFQUFFLENBQUM7SUFDeEMsTUFBTSxxQkFBcUIsR0FBRztRQUM1QixtQkFBVSxDQUFDLFdBQVc7UUFDdEIsbUJBQVUsQ0FBQyxTQUFTO1FBQ3BCLG1CQUFVLENBQUMsU0FBUztRQUNwQixtQkFBVSxDQUFDLG9CQUFvQjtRQUMvQixtQkFBVSxDQUFDLHFCQUFxQjtLQUNqQyxDQUFDO0lBQ0YsTUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLFdBQVcsSUFBSSxLQUFLLENBQUM7SUFDakQsTUFBTSxFQUFFLEdBQUc7UUFDVCxJQUFJLEVBQUUsT0FBTyxDQUFDLElBQUk7UUFDbEIsV0FBVyxFQUFFLE9BQU8sRUFBRSxXQUFXLElBQUksSUFBSTtRQUN6QyxjQUFjLEVBQUUsT0FBTyxDQUFDLGNBQWMsSUFBSSxRQUFRO0tBQ25ELENBQUM7SUFFRixNQUFNLGNBQWMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxjQUFjLElBQUkscUJBQXFCLENBQUMsRUFBRSxHQUFHLENBQzNFLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FDYixJQUFBLHFCQUFXLEVBQUM7UUFDVixNQUFNLEVBQUUsVUFBVTtRQUNsQixJQUFJLEVBQUUsb0JBQVE7UUFDZCxXQUFXLEVBQUUsbUJBQVksQ0FBQyxVQUFVLENBQUM7S0FDdEMsQ0FBQyxDQUNMLENBQUM7SUFFRixPQUFPLElBQUEsd0JBQWUsRUFDcEIsSUFBQSx5QkFBTSxHQUFFLEVBQ1IsSUFBQSxzQkFBWSxFQUFDLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsQ0FBQyxFQUMzQyxJQUFBLGlCQUFRLEVBQUMsT0FBTyxDQUFDLFVBQVUsSUFBSSxpQkFBaUIsQ0FBQyxFQUNqRCxXQUFXLENBQUMsQ0FBQyxDQUFDLElBQUEseUNBQW9CLEVBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUEsdUJBQWEsRUFBQyxFQUFFLENBQUMsRUFDMUQsR0FBRyxjQUFjLENBQ2xCLENBQUM7QUFDSixDQUFDLENBQUM7QUFoQ1csUUFBQSxTQUFTLGFBZ0NwQjtBQUVLLE1BQU0sT0FBTyxHQUFHLENBQUMsVUFBMkIsRUFBRSxFQUFtQixFQUFFO0lBQ3hFLE1BQU0saUJBQWlCLEdBQUcsbUJBQVUsQ0FBQyxFQUFFLENBQUM7SUFDeEMsTUFBTSxxQkFBcUIsR0FBRztRQUM1QixtQkFBVSxDQUFDLFdBQVc7UUFDdEIsbUJBQVUsQ0FBQyxZQUFZO1FBQ3ZCLG1CQUFVLENBQUMsU0FBUztRQUNwQixtQkFBVSxDQUFDLFNBQVM7UUFDcEIsbUJBQVUsQ0FBQyxvQkFBb0I7UUFDL0IsbUJBQVUsQ0FBQyxxQkFBcUI7S0FDakMsQ0FBQztJQUNGLE1BQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxXQUFXLElBQUksS0FBSyxDQUFDO0lBQ2pELE1BQU0sRUFBRSxHQUFHO1FBQ1QsSUFBSSxFQUFFLE9BQU8sQ0FBQyxJQUFJO1FBQ2xCLFdBQVcsRUFBRSxPQUFPLEVBQUUsV0FBVyxJQUFJLElBQUk7UUFDekMsY0FBYyxFQUFFLE9BQU8sQ0FBQyxjQUFjLElBQUksUUFBUTtLQUNuRCxDQUFDO0lBQ0YsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLEtBQUssSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBRXZDLE1BQU0sY0FBYyxHQUFHLENBQUMsT0FBTyxDQUFDLGNBQWMsSUFBSSxxQkFBcUIsQ0FBQyxFQUFFLEdBQUcsQ0FDM0UsQ0FBQyxVQUFVLEVBQUUsRUFBRSxDQUNiLElBQUEscUJBQVcsRUFBQztRQUNWLE1BQU0sRUFBRSxVQUFVO1FBQ2xCLElBQUksRUFBRSxvQkFBUTtRQUNkLFdBQVcsRUFBRSxtQkFBWSxDQUFDLFVBQVUsQ0FBQztLQUN0QyxDQUFDLENBQ0wsQ0FBQztJQUVGLE1BQU0sY0FBYyxHQUFHLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRTtRQUN4QyxRQUFRLElBQUksRUFBRSxDQUFDO1lBQ2IsS0FBSyxPQUFPO2dCQUNWLE9BQU8sSUFBQSxzQkFBWSxHQUFFLENBQUM7WUFDeEIsS0FBSyxTQUFTO2dCQUNaLE9BQU8sSUFBQSxxQkFBVyxFQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ2hDLEtBQUssS0FBSztnQkFDUixPQUFPLElBQUEsdUJBQWEsR0FBRSxDQUFDO1FBQzNCLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVILE9BQU8sSUFBQSx3QkFBZSxFQUNwQixJQUFBLHNCQUFZLEVBQUMsRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQzNDLElBQUEsaUJBQVEsRUFBQyxPQUFPLENBQUMsVUFBVSxJQUFJLGlCQUFpQixDQUFDLEVBQ2pELFdBQVc7UUFDVCxDQUFDLENBQUMsSUFBQSx5Q0FBb0IsRUFBQyxFQUFFLENBQUM7UUFDMUIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFVLEtBQUssR0FBRztZQUMxQixDQUFDLENBQUMsSUFBQSw0QkFBa0IsRUFBQyxFQUFFLENBQUM7WUFDeEIsQ0FBQyxDQUFDLElBQUEsdUJBQWEsRUFBQyxFQUFFLENBQUMsRUFDdkIsR0FBRyxjQUFjLEVBQ2pCLEdBQUcsY0FBYyxDQUNsQixDQUFDO0FBQ0osQ0FBQyxDQUFDO0FBakRXLFFBQUEsT0FBTyxXQWlEbEIiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRDpcXEZQVFxcU1VNTUVSXzIwMjVcXEVYRTIwMVxcbWFoaWthLXdlYnNpdGUtYmFja2VuZFxcc3JjXFxkZWNvcmF0b3JzXFxodHRwLmRlY29yYXRvcnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXJyb3JEdG8gfSBmcm9tICdAL2NvbW1vbi9kdG8vZXJyb3IuZHRvJztcbmltcG9ydCB7XG4gIEh0dHBDb2RlLFxuICBIdHRwU3RhdHVzLFxuICB0eXBlIFR5cGUsXG4gIGFwcGx5RGVjb3JhdG9ycyxcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHtcbiAgQXBpQmFzaWNBdXRoLFxuICBBcGlCZWFyZXJBdXRoLFxuICBBcGlDcmVhdGVkUmVzcG9uc2UsXG4gIEFwaU9rUmVzcG9uc2UsXG4gIEFwaU9wZXJhdGlvbixcbiAgQXBpUmVzcG9uc2UsXG4gIEFwaVNlY3VyaXR5LFxufSBmcm9tICdAbmVzdGpzL3N3YWdnZXInO1xuaW1wb3J0IHsgU1RBVFVTX0NPREVTIH0gZnJvbSAnaHR0cCc7XG5pbXBvcnQgeyBQdWJsaWMgfSBmcm9tICcuL3B1YmxpYy5kZWNvcmF0b3InO1xuaW1wb3J0IHsgQXBpUGFnaW5hdGVkUmVzcG9uc2UgfSBmcm9tICcuL3N3YWdnZXIuZGVjb3JhdG9ycyc7XG5cbnR5cGUgQXBpUmVzcG9uc2VUeXBlID0gbnVtYmVyO1xudHlwZSBBcGlBdXRoVHlwZSA9ICdiYXNpYycgfCAnYXBpLWtleScgfCAnand0JztcbnR5cGUgUGFnaW5hdGlvblR5cGUgPSAnb2Zmc2V0JyB8ICdjdXJzb3InO1xuXG5pbnRlcmZhY2UgSUFwaU9wdGlvbnM8VCBleHRlbmRzIFR5cGU8YW55Pj4ge1xuICB0eXBlPzogVDtcbiAgc3VtbWFyeT86IHN0cmluZztcbiAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gIGVycm9yUmVzcG9uc2VzPzogQXBpUmVzcG9uc2VUeXBlW107XG4gIHN0YXR1c0NvZGU/OiBIdHRwU3RhdHVzO1xuICBpc1BhZ2luYXRlZD86IGJvb2xlYW47XG4gIHBhZ2luYXRpb25UeXBlPzogUGFnaW5hdGlvblR5cGU7XG59XG5cbnR5cGUgSUFwaVB1YmxpY09wdGlvbnMgPSBJQXBpT3B0aW9uczxUeXBlPGFueT4+O1xuXG5pbnRlcmZhY2UgSUFwaUF1dGhPcHRpb25zIGV4dGVuZHMgSUFwaU9wdGlvbnM8VHlwZTxhbnk+PiB7XG4gIGF1dGhzPzogQXBpQXV0aFR5cGVbXTtcbn1cblxuZXhwb3J0IGNvbnN0IEFwaVB1YmxpYyA9IChvcHRpb25zOiBJQXBpUHVibGljT3B0aW9ucyA9IHt9KTogTWV0aG9kRGVjb3JhdG9yID0+IHtcbiAgY29uc3QgZGVmYXVsdFN0YXR1c0NvZGUgPSBIdHRwU3RhdHVzLk9LO1xuICBjb25zdCBkZWZhdWx0RXJyb3JSZXNwb25zZXMgPSBbXG4gICAgSHR0cFN0YXR1cy5CQURfUkVRVUVTVCxcbiAgICBIdHRwU3RhdHVzLkZPUkJJRERFTixcbiAgICBIdHRwU3RhdHVzLk5PVF9GT1VORCxcbiAgICBIdHRwU3RhdHVzLlVOUFJPQ0VTU0FCTEVfRU5USVRZLFxuICAgIEh0dHBTdGF0dXMuSU5URVJOQUxfU0VSVkVSX0VSUk9SLFxuICBdO1xuICBjb25zdCBpc1BhZ2luYXRlZCA9IG9wdGlvbnMuaXNQYWdpbmF0ZWQgfHwgZmFsc2U7XG4gIGNvbnN0IG9rID0ge1xuICAgIHR5cGU6IG9wdGlvbnMudHlwZSxcbiAgICBkZXNjcmlwdGlvbjogb3B0aW9ucz8uZGVzY3JpcHRpb24gPz8gJ09LJyxcbiAgICBwYWdpbmF0aW9uVHlwZTogb3B0aW9ucy5wYWdpbmF0aW9uVHlwZSB8fCAnb2Zmc2V0JyxcbiAgfTtcblxuICBjb25zdCBlcnJvclJlc3BvbnNlcyA9IChvcHRpb25zLmVycm9yUmVzcG9uc2VzIHx8IGRlZmF1bHRFcnJvclJlc3BvbnNlcyk/Lm1hcChcbiAgICAoc3RhdHVzQ29kZSkgPT5cbiAgICAgIEFwaVJlc3BvbnNlKHtcbiAgICAgICAgc3RhdHVzOiBzdGF0dXNDb2RlLFxuICAgICAgICB0eXBlOiBFcnJvckR0byxcbiAgICAgICAgZGVzY3JpcHRpb246IFNUQVRVU19DT0RFU1tzdGF0dXNDb2RlXSxcbiAgICAgIH0pLFxuICApO1xuXG4gIHJldHVybiBhcHBseURlY29yYXRvcnMoXG4gICAgUHVibGljKCksXG4gICAgQXBpT3BlcmF0aW9uKHsgc3VtbWFyeTogb3B0aW9ucz8uc3VtbWFyeSB9KSxcbiAgICBIdHRwQ29kZShvcHRpb25zLnN0YXR1c0NvZGUgfHwgZGVmYXVsdFN0YXR1c0NvZGUpLFxuICAgIGlzUGFnaW5hdGVkID8gQXBpUGFnaW5hdGVkUmVzcG9uc2Uob2spIDogQXBpT2tSZXNwb25zZShvayksXG4gICAgLi4uZXJyb3JSZXNwb25zZXMsXG4gICk7XG59O1xuXG5leHBvcnQgY29uc3QgQXBpQXV0aCA9IChvcHRpb25zOiBJQXBpQXV0aE9wdGlvbnMgPSB7fSk6IE1ldGhvZERlY29yYXRvciA9PiB7XG4gIGNvbnN0IGRlZmF1bHRTdGF0dXNDb2RlID0gSHR0cFN0YXR1cy5PSztcbiAgY29uc3QgZGVmYXVsdEVycm9yUmVzcG9uc2VzID0gW1xuICAgIEh0dHBTdGF0dXMuQkFEX1JFUVVFU1QsXG4gICAgSHR0cFN0YXR1cy5VTkFVVEhPUklaRUQsXG4gICAgSHR0cFN0YXR1cy5GT1JCSURERU4sXG4gICAgSHR0cFN0YXR1cy5OT1RfRk9VTkQsXG4gICAgSHR0cFN0YXR1cy5VTlBST0NFU1NBQkxFX0VOVElUWSxcbiAgICBIdHRwU3RhdHVzLklOVEVSTkFMX1NFUlZFUl9FUlJPUixcbiAgXTtcbiAgY29uc3QgaXNQYWdpbmF0ZWQgPSBvcHRpb25zLmlzUGFnaW5hdGVkIHx8IGZhbHNlO1xuICBjb25zdCBvayA9IHtcbiAgICB0eXBlOiBvcHRpb25zLnR5cGUsXG4gICAgZGVzY3JpcHRpb246IG9wdGlvbnM/LmRlc2NyaXB0aW9uID8/ICdPSycsXG4gICAgcGFnaW5hdGlvblR5cGU6IG9wdGlvbnMucGFnaW5hdGlvblR5cGUgfHwgJ29mZnNldCcsXG4gIH07XG4gIGNvbnN0IGF1dGhzID0gb3B0aW9ucy5hdXRocyB8fCBbJ2p3dCddO1xuXG4gIGNvbnN0IGVycm9yUmVzcG9uc2VzID0gKG9wdGlvbnMuZXJyb3JSZXNwb25zZXMgfHwgZGVmYXVsdEVycm9yUmVzcG9uc2VzKT8ubWFwKFxuICAgIChzdGF0dXNDb2RlKSA9PlxuICAgICAgQXBpUmVzcG9uc2Uoe1xuICAgICAgICBzdGF0dXM6IHN0YXR1c0NvZGUsXG4gICAgICAgIHR5cGU6IEVycm9yRHRvLFxuICAgICAgICBkZXNjcmlwdGlvbjogU1RBVFVTX0NPREVTW3N0YXR1c0NvZGVdLFxuICAgICAgfSksXG4gICk7XG5cbiAgY29uc3QgYXV0aERlY29yYXRvcnMgPSBhdXRocy5tYXAoKGF1dGgpID0+IHtcbiAgICBzd2l0Y2ggKGF1dGgpIHtcbiAgICAgIGNhc2UgJ2Jhc2ljJzpcbiAgICAgICAgcmV0dXJuIEFwaUJhc2ljQXV0aCgpO1xuICAgICAgY2FzZSAnYXBpLWtleSc6XG4gICAgICAgIHJldHVybiBBcGlTZWN1cml0eSgnQXBpLUtleScpO1xuICAgICAgY2FzZSAnand0JzpcbiAgICAgICAgcmV0dXJuIEFwaUJlYXJlckF1dGgoKTtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiBhcHBseURlY29yYXRvcnMoXG4gICAgQXBpT3BlcmF0aW9uKHsgc3VtbWFyeTogb3B0aW9ucz8uc3VtbWFyeSB9KSxcbiAgICBIdHRwQ29kZShvcHRpb25zLnN0YXR1c0NvZGUgfHwgZGVmYXVsdFN0YXR1c0NvZGUpLFxuICAgIGlzUGFnaW5hdGVkXG4gICAgICA/IEFwaVBhZ2luYXRlZFJlc3BvbnNlKG9rKVxuICAgICAgOiBvcHRpb25zLnN0YXR1c0NvZGUgPT09IDIwMVxuICAgICAgICA/IEFwaUNyZWF0ZWRSZXNwb25zZShvaylcbiAgICAgICAgOiBBcGlPa1Jlc3BvbnNlKG9rKSxcbiAgICAuLi5hdXRoRGVjb3JhdG9ycyxcbiAgICAuLi5lcnJvclJlc3BvbnNlcyxcbiAgKTtcbn07XG4iXSwidmVyc2lvbiI6M30=